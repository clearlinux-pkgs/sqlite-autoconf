From e92580434d2cdca228649d32f76167492de4f512 Mon Sep 17 00:00:00 2001
From: "D. Richard Hipp" <drh@hwaci.com>
Date: Thu, 19 Dec 2019 15:15:40 +0000
Subject: [PATCH] Fix the zipfile extension so that INSERT works even if the
 pathname of the file being inserted is a NULL.  Bug discovered by the
 Yongheng and Rui fuzzer.

FossilOrigin-Name: a80f84b511231204658304226de3e075a55afc2e3f39ac063716f7a57f585c06
---
 shell.c   | 1 +
 sqlite3.c | 4 ++--
 sqlite3.h | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/shell.c b/shell.c
index 053180c..404a8d4 100644
--- a/shell.c
+++ b/shell.c
@@ -5827,6 +5827,7 @@ static int zipfileUpdate(
 
     if( rc==SQLITE_OK ){
       zPath = (const char*)sqlite3_value_text(apVal[2]);
+      if( zPath==0 ) zPath = "";
       nPath = (int)strlen(zPath);
       mTime = zipfileGetTime(apVal[4]);
     }
diff --git a/sqlite3.c b/sqlite3.c
index a83b3d2..d29da07 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -1167,7 +1167,7 @@ extern "C" {
 */
 #define SQLITE_VERSION        "3.30.1"
 #define SQLITE_VERSION_NUMBER 3030001
-#define SQLITE_SOURCE_ID      "2019-10-10 20:19:45 18db032d058f1436ce3dea84081f4ee5a0f2259ad97301d43c426bc7f3dfalt1"
+#define SQLITE_SOURCE_ID      "2019-12-19 15:15:40 8922eb97486394fd5ccb8a26b5968022333f65dac4d4876274453693f8d3alt1"
 
 /*
 ** CAPI3REF: Run-Time Library Version Numbers
@@ -225058,7 +225058,7 @@ SQLITE_API int sqlite3_stmt_init(
 /************** End of stmt.c ************************************************/
 #if __LINE__!=225059
 #undef SQLITE_SOURCE_ID
-#define SQLITE_SOURCE_ID      "2019-10-10 20:19:45 18db032d058f1436ce3dea84081f4ee5a0f2259ad97301d43c426bc7f3dfalt2"
+#define SQLITE_SOURCE_ID      "2019-12-19 15:15:40 8922eb97486394fd5ccb8a26b5968022333f65dac4d4876274453693f8d3alt2"
 #endif
 /* Return the source-id for this library */
 SQLITE_API const char *sqlite3_sourceid(void){ return SQLITE_SOURCE_ID; }
diff --git a/sqlite3.h b/sqlite3.h
index 1b405c1..ff44e86 100644
--- a/sqlite3.h
+++ b/sqlite3.h
@@ -125,7 +125,7 @@ extern "C" {
 */
 #define SQLITE_VERSION        "3.30.1"
 #define SQLITE_VERSION_NUMBER 3030001
-#define SQLITE_SOURCE_ID      "2019-10-10 20:19:45 18db032d058f1436ce3dea84081f4ee5a0f2259ad97301d43c426bc7f3dfalt1"
+#define SQLITE_SOURCE_ID      "2019-12-19 15:15:40 8922eb97486394fd5ccb8a26b5968022333f65dac4d4876274453693f8d3alt1"
 
 /*
 ** CAPI3REF: Run-Time Library Version Numbers
-- 
2.24.1

