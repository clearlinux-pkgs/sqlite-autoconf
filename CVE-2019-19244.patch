From 5c9336c7a3998a2a5f91c30cd6cd390b96b9c446 Mon Sep 17 00:00:00 2001
From: dan <dan@noemail.net>
Date: Fri, 22 Nov 2019 10:14:01 +0000
Subject: [PATCH 2/2] Fix a crash that could occur if a sub-select that uses
 both DISTINCT and window functions also used an ORDER BY that is the same as
 its select list.

Amalgamation version of the patch:
FossilOrigin-Name: bcdd66c1691955c697f3d756c2b035acfe98f6aad72e90b0021bab6e9023b3ba
---
 sqlite3.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/sqlite3.c b/sqlite3.c
index bf9b1b2..242b868 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -131684,6 +131684,7 @@ SQLITE_PRIVATE int sqlite3Select(
   */
   if( (p->selFlags & (SF_Distinct|SF_Aggregate))==SF_Distinct 
    && sqlite3ExprListCompare(sSort.pOrderBy, pEList, -1)==0
+   && p->pWin==0
   ){
     p->selFlags &= ~SF_Distinct;
     pGroupBy = p->pGroupBy = sqlite3ExprListDup(db, pEList, 0);
@@ -225058,7 +225059,7 @@ SQLITE_API int sqlite3_stmt_init(
 #endif /* !defined(SQLITE_CORE) || defined(SQLITE_ENABLE_STMTVTAB) */
 
 /************** End of stmt.c ************************************************/
-#if __LINE__!=225061
+#if __LINE__!=225062
 #undef SQLITE_SOURCE_ID
 #define SQLITE_SOURCE_ID      "2019-10-10 20:19:45 18db032d058f1436ce3dea84081f4ee5a0f2259ad97301d43c426bc7f3dfalt2"
 #endif
-- 
2.24.0

